%load policies
% addpath(genpath('../Toolbox/Library'));
%locate program
clear all;
reset(symengine);
excmd = '../../../../rele-build/datadiff2mat';

%% REINFORCE
algorthm = 'r';

% policy for dam
stateDim = 1;
actionDim = 1;
s = sym('s', [stateDim, 1]);
a = sym('a', [actionDim, 1]);
syms c1 c2 c3 c4 w1 w2 w3 w4
phi0 = 1;
phi1 = exp(-(s - c1)/w1);
phi2 = exp(-(s - c2)/w2);
phi3 = exp(-(s - c3)/w3);
phi4 = exp(-(s - c4)/w4);
phi  = [phi0; phi1; phi2; phi3; phi4];
centers = [0; 50; 120; 160];
widths  = [50; 20; 40; 50];
phi = subs(phi, [c1;c2;c3;c4;w1;w2;w3;w2], [centers;widths]);

theta = sym('theta', [size(phi,1), 1]);
mu = transpose(phi)*theta;
diff = (a - mu);
sigma = sym('sg', [actionDim,1]);
S = diag(sigma.*sigma);
pols = (2*pi)^(-actionDim/2) * det(S)^(-1/2) * exp( ...
    -0.5 * transpose(diff) * inv(S) * diff ...
    );

% polf = matlabFunction(pols);

g = transpose(jacobian(log(pols), theta));
h = jacobian(g, theta);

params = [50; -50; 0; 0; 50];

% write parameters
mkdir('/tmp/ReLe/pol2mat/test/')
dlmwrite('/tmp/ReLe/pol2mat/test/state.dat', state, 'delimiter', '\t', 'precision', 10);
dlmwrite('/tmp/ReLe/pol2mat/test/action.dat', action, 'delimiter', '\t', 'precision', 10);
dlmwrite('/tmp/ReLe/pol2mat/test/params.dat', wVal, 'delimiter', '\t', 'precision', 10);
dlmwrite('/tmp/ReLe/pol2mat/test/stddev.dat', sigmaVal, 'delimiter', '\t', 'precision', 10);
dlmwrite('/tmp/ReLe/pol2mat/test/deg.dat', polDeg, 'delimiter', '\t');

tcmd = [excmd ' ' polname ' /tmp/ReLe/pol2mat/test/params.dat /tmp/ReLe/pol2mat/test/stddev.dat '... 
    '/tmp/ReLe/pol2mat/test/state.dat ' ...
    '/tmp/ReLe/pol2mat/test/action.dat /tmp/ReLe/pol2mat/test/deg.dat'];

disp('------------------------');
status = system(tcmd);
disp('------------------------');




